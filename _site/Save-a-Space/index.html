<!DOCTYPE html>
<html>
<head>

    <title>
        Data science for parking availability prediction – Tomas Pereira de Vasconcelos – Physics, math, tech
    </title>

    <meta charset="utf-8"/>
<meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
<meta http-equiv='X-UA-Compatible' content='IE=edge'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>



<meta name="description" content="Accelogress Ltd is a UK based software consultancy company developing
mobile app solutions using data analysis, machine learning, and API
technologies. Accelogress’ project,
Save-a-Space, introduces a cloud-based
mobile marketplace for real-time booking of parking spaces, which
optimizes parking management (for parking operators) and drivers’
experience (for the end-users).  Save-a-Space’s mobile app allows drivers
to easily find and book the most suitable parking space, according to
their personal preferences.

"/>
<meta property="og:description" content="Accelogress Ltd is a UK based software consultancy company developing
mobile app solutions using data analysis, machine learning, and API
technologies. Accelogress’ project,
Save-a-Space, introduces a cloud-based
mobile marketplace for real-time booking of parking spaces, which
optimizes parking management (for parking operators) and drivers’
experience (for the end-users).  Save-a-Space’s mobile app allows drivers
to easily find and book the most suitable parking space, according to
their personal preferences.

"/>

<meta name="author" content="Tomas Pereira de Vasconcelos"/>


<meta property="og:title" content="Data science for parking availability prediction"/>
<meta property="twitter:title" content="Data science for parking availability prediction"/>


    <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<![endif]-->


<!-- FONTS -->
<!-- Serif -->
<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,600,600i,700,700i" rel="stylesheet">
<!--<link href="https://fonts.googleapis.com/css?family=Averia+Serif+Libre:300,300i,400,400i,700,700i" rel="stylesheet">-->
<!--<link href="https://fonts.googleapis.com/css?family=Comfortaa:300,400,700" rel="stylesheet">-->

<!-- Sans -->
<!--<link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i" rel="stylesheet">-->
<!--<link href="https://fonts.googleapis.com/css?family=Vollkorn:400,400i,600,600i,700,700i" rel="stylesheet">-->
<link href="https://fonts.googleapis.com/css?family=Merriweather:400,400i,700,700i" rel="stylesheet">

<!-- Computer Modern (LaTeX) -->
<!--<link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/dreampulse/computer-modern-web-font/master/fonts.css">-->
<!-- FONTS -->


<!-- MathJax CDN -->
<!-- <script type="text/javascript" async
        src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script> -->
<script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<!-- MathJax CDN -->


<link rel="stylesheet" type="text/css" href="/style.css"/>
<link rel="alternate" type="application/rss+xml" title="Tomas Pereira de Vasconcelos - Physics, math, tech"
      href="/feed.xml"/>

</head>

<body>

<div id="grid-sidebarbody">

    <div id="header-mobile">

    <a href="/mobilemenu/">
        <i class="svg-icon mobilemenu"></i>
    </a>


</div>

<header>

    <div id="header-nameandsvgs">

    <div id="header-fullname">
        <a href="/">
            Tomas Pereira de <span id="vasconcelos">Vasconcelos</span>
        </a>
    </div>

    <div id="svg-icons">

    
    <a href="mailto:tomasvasconcelos1@gmail.com">
        <i class="svg-icon email"></i>
    </a>
    


    
    <a href="https://github.com/TPVasconcelos">
        <i class="svg-icon github"></i>
    </a>
    


    
    <a href="tel:+44(0)7874198319">
        <i class="svg-icon phone"></i>
    </a>
    


    
    <a href="https://stackoverflow.com/users/6028742/tpvasconcelos">
        <i class="svg-icon stackoverflow"></i>
    </a>
    


    
    <a href="https://www.linkedin.com/in/tomasvasconcelos/">
        <i class="svg-icon linkedin"></i>
    </a>
    


    
    <a href="https://www.instagram.com/tomasvasconcelos/">
        <i class="svg-icon instagram"></i>
    </a>
    

</div>

</div>

<nav>

    <div class="nav-parent">
        <a href="/about/">About</a>
        <div class="nav-child">
            <a href="/education/">Education</a>
        </div>
        <div class="nav-child">
            <a href="/computing-experience/">Computing Experience</a>
        </div>
    </div>

    <div class="nav-parent">
        <a href="/research/">Research</a>
    </div>

    <div class="nav-parent">
        <a href="/projects/">Projects</a>
    </div>

    <div class="nav-parent">
        <a href="/blog/">P=NP</a>
    </div>

</nav>


</header>

    <!-- ************************************************** -->
    <div>

        <div class="container">
    <article class="post">

        <div class="md-articletitlesection">
            <h1 class="md-articletitle">Data science for parking availability prediction</h1>
            <h2 class="md-articlesubtitle">Quick insight into how I've built the engine and API dealing with the real-time analysis of parking data and occupancy prediction for the Save-a-Space project</h2>

            <div class="post-date-time">
                
                

                

                

                Nov  4, 2016 &#160;<b>&#183;</b>&#160; 4 min read
            </div>

        </div>


        <div class="entry"><p>Accelogress Ltd is a UK based software consultancy company developing
mobile app solutions using data analysis, machine learning, and API
technologies. Accelogress’ project,
<a href="https://save-a-space.com">Save-a-Space</a>, introduces a cloud-based
mobile marketplace for real-time booking of parking spaces, which
optimizes parking management (for parking operators) and drivers’
experience (for the end-users).  Save-a-Space’s mobile app allows drivers
to easily find and book the most suitable parking space, according to
their personal preferences.</p>

<p><img src="/assets/images/posts/saveaspacesearch.jpg" alt="" title="" /></p>

<figcaption>The Save-a-Space mobile app will automatically find the best parking space according to user preferences.</figcaption>

<p>During my summer internship at Accelogress Ltd, I was trusted with
building the engine and API that deals with the real-time analysis of
parking data and occupancy prediction for their Save-a-Space project.
The API would have to allow for a simple but flexible access to
historical data, as well availability predictions.</p>

<h1 id="the-api">The API</h1>

<p>Since the prediction engine was going to be built with Python, it made
sense to also build the API with some Python framework for easy
integration of the two. The API was built using
<a href="http://www.django-rest-framework.org">Django REST framework</a>, which can
quietly sit on top of a <a href="https://www.djangoproject.com/">Django</a> server.
Having this integrated setup also allowed for scheduled remote updating
of prediction datasets. The API allows applications and end-users to
query historical data for any car park, as well as predictions of future
occupancy. The Django server was mounted onto a
<a href="https://gunicorn.org/">Gunicorn</a> which, in turn, runs on an
<a href="https://www.nginx.com/">nginx</a> server. The whole environment runs on a
<a href="https://www.docker.com/">Docker</a> container, which makes it easy and
quick to go from development into a production environment.</p>

<p><img src="/assets/images/posts/SASserverpipeline.png" alt="" title="" /></p>

<figcaption>Diagram of the server setup used.</figcaption>

<h1 id="the-prediction-engine">The Prediction Engine</h1>

<p>Thanks to Google’s <a href="http://scikit-learn.org">scikit-learn</a> machine
learning library, the implementation of the prediction algorithm was one
of the most straight forward parts of this project. The goal was to
predict the occupancy of a car-park at some point in the future. We had
years worth of parking data, which was important for testing different
algorithms and optimizing the ones that performed best.
I chose the <a href="https://en.wikipedia.org/wiki/Mean_squared_error"><em>mean-squared-error</em></a>
(MSE) to be our performance metric. What we need now is to minimise
the MSE of our algorithm, as a MSE of zero represents a perfect estimator.</p>

<p>The algorithm can take as input parameters like: month; week-day; hour;
bank holidays (True/False); etc… and outputs the predicted
availability. The choice of input parameters affects the
performance of the algorithm. To find the optimal machine learning
<em>smoothie</em>, I ran a brute-force test with multiple algorithms for
multiple car parks with different combinations of input parameters,
with the goal of minimizing the MSE. In the end, I found the
<a href="http://scikit-learn.org/stable/modules/tree.html">Decision Tree Algorithm</a>
to be the most suitable and reliable estimator. Decision trees allow
us to easily visualise the underlying model, which can be very useful to
communicate the factors that most influence the occupancy of a car park.
This can be especially useful for parking operators. Each algorithm
will have its own extra set of parameters that can be extremely useful for
minimizing the MSE. In the case of trees, we can use the <em>maximum-depth</em>
to limit its size and prevent
<a href="https://en.wikipedia.org/wiki/Overfitting">overfitting</a>. After tuning
each ingredient I was able to get the MSE of our algorithm to be as low
as 0.37%!</p>

<p><img src="/assets/images/posts/sashistvspred.png" alt="" title="" /></p>

<figcaption>Comparison of the predicted data (Orange) and real data (Blue)</figcaption>

<h2 id="working-example">Working example</h2>

<p>This is a quick working example of how to get started with the tree
classifier from scikit-learn. In this first code block I am generating
some example data that we will need to train and test our chosen algorithm.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="n">SAMPLE_SIZE</span> <span class="o">=</span> <span class="mi">896</span>  <span class="c"># 28 * 6</span>

<span class="c"># 4 weeks range: 28 days times 2*pi radians</span>
<span class="n">t_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">56</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">SAMPLE_SIZE</span><span class="p">)</span>

<span class="c"># Generate a sin wave for the occupancy percentage</span>
<span class="n">occupancy</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t_range</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="c"># Reduce occupancy on weekends</span>
<span class="n">occupancy</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">SAMPLE_SIZE</span> <span class="o">/</span> <span class="mi">28</span><span class="p">)</span>
<span class="c"># Add some random noise</span>
<span class="n">occupancy</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SAMPLE_SIZE</span><span class="p">)</span>
<span class="c"># Round the occupancy percentage to the nearest integer</span>
<span class="n">occupancy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="n">occupancy</span><span class="p">)</span>

<span class="c"># Convert from radians to 'days' and</span>
<span class="c"># clip days of week between 0 and 6</span>
<span class="n">t_range_cliped</span> <span class="o">=</span> <span class="p">(</span><span class="n">t_range</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">%</span> <span class="mi">7</span>
<span class="n">weekdays</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="n">t_range_cliped</span><span class="p">)</span>
<span class="c"># transform fractional part of the day to an hour</span>
<span class="n">hour</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">modf</span><span class="p">(</span><span class="n">t_range_cliped</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">24</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div></div>

<p>The code above generates an hypothetical dataset for a car park that peaks
at mid-day and has less occupancy on weekends. In this example I generated
4 weeks of data. The image bellow shows the first 14 days of the generated
dataset.</p>

<p><img src="/assets/images/posts/sklearnSAS.png" alt="" title="" /></p>

<figcaption>The first 14 days of generated example data.</figcaption>

<p>As you’ll see bellow, getting started with the sklearn library is extremely
easy. This is a very simple example of how we could use the data generated
above to make availability predictions in the future. In the example bellow
the Decision Tree Classifier predicts that on Sundays at mid-day the
occupancy is around 48% and on Tuesdays at 9am is around 70%. Comparing
this prediction with the plot above, we see that the tree was accurate.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>

<span class="c"># Create and instance of DecisionTreeClassifier</span>
<span class="n">clf</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">()</span>

<span class="c"># Input parameters (features): day-of-week, hour-of-day</span>
<span class="n">input_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">weekdays</span><span class="p">,</span> <span class="n">hour</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># Train the classifier</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">input_features</span><span class="p">,</span> <span class="n">occupancy</span><span class="p">)</span>

<span class="c"># Make a prediction for:</span>
<span class="c">#   - Sunday at 12pm: [6, 12]</span>
<span class="c">#   - Tuesday at 9am: [1, 9]</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">([[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">]])</span>
<span class="k">print</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span>
</code></pre></div></div>
</div>

    </article>

    <div class="tags">

        <ul>
            
                <li>
                    <a href="/">
                        Machine-Learning
                    </a>
                </li>
            
                <li>
                    <a href="/">
                        projects
                    </a>
                </li>
            
                <li>
                    <a href="/">
                        Python
                    </a>
                </li>
            
                <li>
                    <a href="/">
                        API
                    </a>
                </li>
            
        </ul>

    </div>

</div>

    </div>
    <!-- ************************************************** -->

</div>

<div class="wrapper-footer">
    <footer class="footer">
        <!--<div id="svg-icons">

    
    <a href="mailto:tomasvasconcelos1@gmail.com">
        <i class="svg-icon email"></i>
    </a>
    


    
    <a href="https://github.com/TPVasconcelos">
        <i class="svg-icon github"></i>
    </a>
    


    
    <a href="tel:+44(0)7874198319">
        <i class="svg-icon phone"></i>
    </a>
    


    
    <a href="https://stackoverflow.com/users/6028742/tpvasconcelos">
        <i class="svg-icon stackoverflow"></i>
    </a>
    


    
    <a href="https://www.linkedin.com/in/tomasvasconcelos/">
        <i class="svg-icon linkedin"></i>
    </a>
    


    
    <a href="https://www.instagram.com/tomasvasconcelos/">
        <i class="svg-icon instagram"></i>
    </a>
    

</div>-->
    </footer>
</div>


	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-111484808-1', 'auto');
		ga('send', 'pageview', {
		  'page': '/Save-a-Space/',
		  'title': 'Data science for parking availability prediction'
		});
	</script>
	<!-- End Google Analytics -->


</body>
</html>
